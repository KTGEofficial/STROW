<html><head>
  <title>STROW Mainpage</title><head>
  <style id="dynamic-theme"></style>
  <script>
    const lightCSS = `
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        overflow-x: hidden;
        overflow-y: auto;
        background: linear-gradient(to bottom left, hsl(180, 96%, 96%), hsl(150, 96%, 96%));
        font-family: sans-serif;
      }

      .grid-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: 
          linear-gradient(to right, rgba(255, 255, 255, 0.5) 8px, transparent 1px),
          linear-gradient(to bottom, rgba(255, 255, 255, 0.5) 8px, transparent 1px);
        background-size: 40px 40px;
        pointer-events: none;
        z-index: 0;
      }

      .content {
        position: relative;
        z-index: 1;
        padding: 2rem;
        text-align: center;
      }
    `;

    const darkCSS = `
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        overflow-x: hidden;
        overflow-y: auto;
        background: linear-gradient(to bottom left, hsl(240, 96%, 16%), hsl(0, 0%, 0%), hsl(332, 96%, 32%));
        font-family: sans-serif;
        color: white;
      }

      .grid-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: 
          linear-gradient(to right, rgba(255, 255, 255, 0.125) 8px, transparent 1px),
          linear-gradient(to bottom, rgba(255, 255, 255, 0.125) 8px, transparent 1px);
        background-size: 40px 40px;
        pointer-events: none;
        z-index: 0;
      }

      .content {
        position: relative;
        z-index: 1;
        padding: 2rem;
        text-align: center;
      }
    `;

    function applyTheme() {
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const styleTag = document.getElementById('dynamic-theme');
      styleTag.textContent = prefersDark ? darkCSS : lightCSS;
    }

    applyTheme();

    // Optional: Listen for changes in system theme
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', applyTheme);
  </script>
<style>
    .button-link {
  position: relative;
  display: inline-block;
  text-decoration: none;
  color: white;
  font-size: 1rem;
  font-weight: bold;
  padding: 0.75rem 1.5rem;
  border-radius: 1rem;
  background-image: linear-gradient(to bottom left, #00FFFF, #00FF7F); /* Gradient restored */
  box-shadow: 0 4px 8px rgba(0, 255, 127, 0.3);
  cursor: pointer;
  overflow: hidden;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  z-index: 1;
}


    .button-link:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 12px rgba(0, 255, 255, 0.4);
    }

    .button-link:active {
      transform: scale(0.98);
      box-shadow: 0 2px 6px rgba(0, 255, 255, 0.2);
    }

    .ripple-outline {
  position: absolute;
  border: 2px solid rgba(0, 255, 255, 0.4); /* Soft green glow */
  border-radius: 1rem;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  transform: scale(1);
  animation: ripple-outline-animation 800ms ease-out;
  pointer-events: none;
  z-index: 0; /* Behind the button text */
}


    @keyframes ripple-outline-animation {
      0% {
        transform: scale(1);
        opacity: 0.8;
      }
      100% {
        transform: scale(2.5);
        opacity: 0;
      }
    }.result-card {
  background: none;
  padding: 1em;
  margin-bottom: 1em;
  border-radius: 6px;
  transition: transform 0.2s ease;
}

    .result-card:hover {
  transform: scale(1.02);
}

  </style>
</head>
<body>
  <div id="strow-container"></div><div class="content"><div class="search-results" id="search-results"></div></div>
<div class="grid-overlay"></div>
  <script>async function getCookie() {
  const cookies = document.cookie.split(';');
  for (let cookie of cookies) {
    cookie = cookie.trim();
    if (cookie.startsWith("verification" + '=')) {
      return cookie.substring("verification".length + 1);
    }
  }
  return null;
}function calculateTimeMultiplier(nowUTC, releaseInput, deadlineInput) {
      if (!deadlineInput) {
        return 1;
      }
      const releaseTime = new Date(releaseInput).getTime();
      const deadlineTime = new Date(deadlineInput).getTime();
      const nowTime = new Date(nowUTC).getTime();
      if (deadlineTime <= releaseTime) {
        return 1;
      }
      const totalDuration = deadlineTime - releaseTime;
      const elapsed = nowUTC - releaseTime;
      const progressRatio = elapsed / totalDuration;
      if (progressRatio <= 1) {
    return (6 * Math.pow(progressRatio, 3)) - (5 * Math.pow(progressRatio, 2)) + 1.5;
  } else {
    return 0.6 * Math.pow(2.5, (2 - progressRatio)) + 1;
  }
}function calculateFinalScores(nowUTC, jsonData) {
  const scores = {};

  for (const id in jsonData) {
    const entry = jsonData[id];
    const views = entry.views || 0;
    const release = entry.timestamp;
    const deadline = entry.deadline;

    const timeMultiplier = calculateTimeMultiplier(nowUTC, release, deadline);
    const referenceText = `${entry.title} ${entry.uploader} ${entry.description}`;

    const finalScore = (views + 1) * timeMultiplier;

    scores[id] = {
      title: entry.title.trim(),
      uploader: entry.uploader,
      finalScore: parseFloat(finalScore)
    };
  }

  return scores;
}function renderSortedResults(scores) {
  const container = document.getElementById("search-results");
  container.innerHTML = "";
  const sortedEntries = Object.entries(scores).sort(([, a], [, b]) => b.finalScore - a.finalScore);
  sortedEntries.forEach(([videoID, entry]) => {
    const anchor = document.createElement("a");
    anchor.href = `https://ktgeofficial.github.io/STROW/video.html?id=${videoID}`;
    anchor.style.textDecoration = "none";
    anchor.style.color = "inherit";
    const card = document.createElement("div");
    card.className = "result-card";
    const titleDiv = document.createElement("div");
    titleDiv.className = "result-title";
    titleDiv.textContent = entry.title;
    titleDiv.style = "font-weight:bold;";
    const uploaderDiv = document.createElement("div");
    uploaderDiv.className = "result-meta";
    uploaderDiv.textContent = `Uploaded by ${entry.uploader}`;
    const idDiv = document.createElement("div");
    idDiv.className = "result-meta";
    idDiv.textContent = videoID;
    card.appendChild(titleDiv);
    card.appendChild(uploaderDiv);
    card.appendChild(idDiv);
    anchor.appendChild(card);
    container.appendChild(anchor);
  });
}
    async function getRawFingerprintData() {
      const traits = [
        navigator.userAgent,
        navigator.language,
        screen.width,
        screen.height,
        screen.colorDepth,
        new Date().getTimezoneOffset(),
        navigator.platform,
        navigator.hardwareConcurrency,
        navigator.deviceMemory || 'unknown',
      ];
      return traits.join('::');
    }

    async function generateHexFingerprint(rawData) {
      const encoder = new TextEncoder();
      const buffer = await crypto.subtle.digest('SHA-256', encoder.encode(rawData));
      if (await getCookie() === null) { return Array.from(new Uint8Array(buffer))
        .map(b => b.toString(16).padStart(2, '0'))
        .join(''); } else { return await getCookie(); }
    }
function findColorScheme(){const e=!window.matchMedia("(prefers-color-scheme: dark)").matches;return document.getElementById("dynamic-theme").textContent=e?lightCSS:darkCSS,e}
    async function validateFingerprint() {
      const rawData = await getRawFingerprintData();
      const hexFingerprint = await generateHexFingerprint(rawData);

      // ? Updated macro URL
      const macroURL = "https://script.google.com/macros/s/AKfycbws83E6-z_290aPyNfg-fzm2dgoyngCmQrezcitwW0CAwIJSmsUUikA4Y7Jq1yGRrSn/exec";
      const query = new URLSearchParams({ mode: "cssc", fingerprint: hexFingerprint, colorscheme: findColorScheme() }).toString();
      const response = await fetch(`${macroURL}?${query}`);
      const result = await response.json();

      if (result.row !== null && result.username) {
        document.getElementById("strow-container").innerHTML = `
          <div class="content">
            <h1>STROW Website</h1>
            <p>You are logged in as ${result.username}</p>
            <a href="https://ktgeofficial.github.io/STROW/search.html" class="button-link">Search</a><br><br>
            <a href="https://ktgeofficial.github.io/STROW/upload.html" class="button-link">Upload a video</a><br><br>
            <a href="https://ktgeofficial.github.io/STROW/accountchange.html" class="button-link">Account Change</a>
          </div>
        `;
      } else {
        window.location.href = "https://ktgeofficial.github.io/STROW/accountchange.html";
      }
    }

    validateFingerprint();
(async () => {
    try {
const rawData = await getRawFingerprintData();
      const hexFingerprint = await generateHexFingerprint(rawData);
      const nowUTC = new Date()
      const query = new URLSearchParams({
        mode: "search",
        fingerprint: hexFingerprint,
        colorscheme: findColorScheme(),
        ishomepage: true,
        searchquery: "",
        timestamp: nowUTC.toISOString()
      }).toString();

      const response = await fetch(
        "https://script.google.com/macros/s/AKfycbws83E6-z_290aPyNfg-fzm2dgoyngCmQrezcitwW0CAwIJSmsUUikA4Y7Jq1yGRrSn/exec?" + query
      );
      const result = await response.json();
      console.log(result);
      const scores = calculateFinalScores(nowUTC, result);
renderSortedResults(scores);
    } catch (error) {
      console.error("Failed to fetch video data:", error);
    }
  })();
  </script>
</body></html>






