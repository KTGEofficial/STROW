<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>STROW Account Change</title>
  <style>/* Unified input styling */
input[type="text"],
input[type="password"],
input[type="email"],
select {
  background-color: white;
  border: 3px solid transparent;
  border-radius: 1rem;
  padding: 0.6rem 1rem;
  font-size: 1rem;
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
  outline: none;
  text-align: center;
  font-family: sans-serif;

  background-image: linear-gradient(to bottom left, #00FFFF, #00FF7F), white;
  background-origin: border-box;
  background-clip: padding-box, border-box;

  box-shadow: 0 0 8px rgba(0, 255, 127, 0.4);
  transition: box-shadow 0.3s ease;
}

/* Focus glow */
input[type="text"]:focus,
input[type="password"]:focus,
input[type="email"]:focus,
select:focus,
textarea:focus {
  box-shadow: 0 0 8px rgba(0, 255, 255, 0.5);
}

/* Button styling replaces input[type="submit"] and input[type="button"] */
button {
  color: white;
  font-size: 1rem;
  font-weight: bold;
  padding: 0.75rem 1.5rem;
  border: none;
  border-radius: 1rem;
  cursor: pointer;
  background-image: linear-gradient(to bottom left, #00FFFF, #00FF7F);
  box-shadow: 0 4px 8px rgba(0, 255, 127, 0.3);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  font-family: sans-serif;
}

/* Hover and active effects for buttons */
button:hover {
  transform: scale(1.05);
  box-shadow: 0 6px 12px rgba(0, 255, 127, 0.4);
}

button:active {
  transform: scale(0.98);
  box-shadow: 0 2px 6px rgba(0, 255, 127, 0.2);
}
</style>
</head>
<body>
   <div class="grid-overlay"></div> <div class="content"> <form id="strowForm">
  <h1>STROW Account Change</h1>

  <p>Log in or sign up?</p>
  <select id="modeSelect" name="mode">
    <option value="login">Log In</option>
    <option value="signup">Sign Up</option>
  </select>
  
  <p><label for="username">Username:</label></p>
  <input type="text" id="username" name="username" required="">

  <p><label for="password">Password:</label></p>
  <input type="password" id="password" name="password" required="">

  <div id="confirmPasswordSection">
    <p><label for="confirm">Confirm Password:</label></p>
    <input type="password" id="confirm" name="confirm">
  </div>

  <p><label for="email">Optional Recovery Email:</label></p>
  <input type="email" id="email" name="email">

  <br><br>
  <button class="button" id="accountChangeButton" onclick="submitSignup()">Sign Up</button>
  <br><br>
  <button class="button" id="forgotBtn" onclick="submitRecovery()">Forgot Password</button><br><br><div class="status" id="status"></div>
</form>

  <script>
    const modeSelect = document.getElementById('modeSelect');
  const confirmSection = document.getElementById('confirmPasswordSection');
  const submitBtn = document.getElementById('accountChangeButton');
  const forgotBtn = document.getElementById('forgotBtn');

  modeSelect.addEventListener('change', () => {
    const mode = modeSelect.value;
    if (mode === 'login') {
      confirmSection.style.display = 'none';
      forgotBtn.style.display = 'inline-block';
      submitBtn.value = 'Log In';
      submitBtn.onclick = 'submitLogin()';
    } else {
      confirmSection.style.display = 'block';
      forgotBtn.style.display = 'none';
      submitBtn.value = 'Sign Up';
      submitBtn.onclick = 'submitSignup()';
    }
  });async function getFingerprints() {
      const traits = [
        navigator.userAgent,
        navigator.language,
        screen.width,
        screen.height,
        screen.colorDepth,
        new Date().getTimezoneOffset(),
        navigator.platform,
        navigator.hardwareConcurrency,
        navigator.deviceMemory || 'unknown',
      ];
      const rawData = traits.join('::');
      const encoder = new TextEncoder();
      const buffer = await crypto.subtle.digest('SHA-256', encoder.encode(rawData));
      const hex = Array.from(new Uint8Array(buffer)).map(b => b.toString(16).padStart(2, '0')).join('');
      const base64 = btoa(rawData);
      return { hex, base64 };
    }

    async function accountChangeFunction(data, redirectOnSuccess = true) {
      try {
        const query = new URLSearchParams(data).toString();
        const response = await fetch(`https://script.google.com/macros/s/AKfycby5pujOqyqNKocTz4z8_aplwuuu7Vl5mUgV4ILD6RA3Rn_mmasFpAf9_mMh11TV6Xd_/exec?${query}`);
        const result = await response.json();

        if (result.success) {
          if (redirectOnSuccess) {
            window.location.href = "https://ktgeofficial.github.io/STROW/";
          } else {
            document.getElementById('status').textContent = "Recovery email sent if matched.";
          }
        } else {
          document.getElementById('status').textContent = result.message || "Operation failed.";
        }
      } catch (err) {
        document.getElementById('status').textContent = "Error communicating with server.";
      }
    }

    async function submitSignup() {
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;
      const confirm = document.getElementById('confirm').value;
      const email = document.getElementById('email').value.trim();
      const { hex, base64 } = await getFingerprints();

      const payload = {
        mode: "signup",
        username,
        password,
        confirm,
        email,
        action: "accountChange",
        fingerprint: hex,
        pseudofingerprint: base64
      };

      accountChangeFunction(payload);
    }

    async function submitLogin() {
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;
      const email = document.getElementById('email').value.trim();
      const { hex, base64 } = await getFingerprints();

      const payload = {
        mode: "login",
        action: "Login",
        username,
        password,
        email,
        fingerprint: hex,
        pseudofingerprint: base64
      };

      accountChangeFunction(payload);
    }

    async function submitRecovery() {
      const username = document.getElementById('username').value.trim();
      const email = document.getElementById('email').value.trim();
      const { hex, base64 } = await getFingerprints();

      const payload = {
        mode: "login",
        action: "Forgot Password",
        username,
        password: "", // not needed
        email,
        fingerprint: hex,
        pseudofingerprint: base64
      };

      accountChangeFunction(payload, false);
    }
  </script>
</body>
</html>



