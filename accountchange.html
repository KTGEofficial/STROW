<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>STROW Signup</title>
  <style>
    body { font-family: sans-serif; padding: 2em; }
    input, button { margin: 0.5em 0; display: block; }
    .status { margin-top: 1em; color: red; }
  </style>
</head>
<body>
  <h2>Signup</h2>
  <input type="text" id="username" placeholder="Username">
  <input type="password" id="password" placeholder="Password">
  <input type="password" id="confirm" placeholder="Confirm Password">
  <input type="email" id="email" placeholder="Email">
  <button onclick="submitSignup()">Sign Up</button>
  <div class="status" id="status"></div>

  <script>
    async function getFingerprints() {
      const traits = [
        navigator.userAgent,
        navigator.language,
        screen.width,
        screen.height,
        screen.colorDepth,
        new Date().getTimezoneOffset(),
        navigator.platform,
        navigator.hardwareConcurrency,
        navigator.deviceMemory || 'unknown',
      ];
      const rawData = traits.join('::');
      const encoder = new TextEncoder();
      const buffer = await crypto.subtle.digest('SHA-256', encoder.encode(rawData));
      const hex = Array.from(new Uint8Array(buffer)).map(b => b.toString(16).padStart(2, '0')).join('');
      const base64 = btoa(rawData);
      return { hex, base64 };
    }

    async function accountChangeFunction(data) {
      try {
        const query = new URLSearchParams(data).toString();
        const response = await fetch(`https://script.google.com/macros/s/AKfycbyRI8jsy8NFvFXdBBx4uzcz397WVPcVJxVWW_81jwKYtGZr2T81h2TrEKYZM4zZ3f7M/exec?${query}`);
        const result = await response.json();

        if (result.success) {
          window.location.href = "https://ktgeofficial.github.io/STROW/";
        } else {
          document.getElementById('status').textContent = result.message || "Signup failed.";
        }
      } catch (err) {
        document.getElementById('status').textContent = "Error communicating with server.";
      }
    }

    async function submitSignup() {
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;
      const confirm = document.getElementById('confirm').value;
      const email = document.getElementById('email').value.trim();
      const { hex, base64 } = await getFingerprints();

      const payload = {
        mode: "signup",
        username,
        password,
        confirm,
        email,
        action: "accountChange",
        fingerprint: hex,
        pseudofingerprint: base64
      };

      accountChangeFunction(payload);
    }
  </script>
</body>
</html>
