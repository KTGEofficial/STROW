<html lang="en"><head><style id="dynamic-theme"></style>
  <script>
    const lightCSS = `
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        overflow-x: hidden;
        overflow-y: auto;
        background: linear-gradient(to bottom left, hsl(180, 96%, 96%), hsl(150, 96%, 96%));
        font-family: sans-serif;
      }

      .grid-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: 
          linear-gradient(to right, rgba(255, 255, 255, 0.5) 8px, transparent 1px),
          linear-gradient(to bottom, rgba(255, 255, 255, 0.5) 8px, transparent 1px);
        background-size: 40px 40px;
        pointer-events: none;
        z-index: 0;
      }

      .content {
        position: relative;
        z-index: 1;
        padding: 2rem;
        text-align: center;
      }
    `;

    const darkCSS = `
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        overflow-x: hidden;
        overflow-y: auto;
        background: linear-gradient(to bottom left, hsl(240, 96%, 16%), hsl(0, 0%, 0%), hsl(332, 96%, 32%));
        font-family: sans-serif;
        color: white;
      }

      .grid-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: 
          linear-gradient(to right, rgba(255, 255, 255, 0.125) 8px, transparent 1px),
          linear-gradient(to bottom, rgba(255, 255, 255, 0.125) 8px, transparent 1px);
        background-size: 40px 40px;
        pointer-events: none;
        z-index: 0;
      }

      .content {
        position: relative;
        z-index: 1;
        padding: 2rem;
        text-align: center;
      }
    `;

    function applyTheme() {
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const styleTag = document.getElementById('dynamic-theme');
      styleTag.textContent = prefersDark ? darkCSS : lightCSS;
    }

    applyTheme();

    // Optional: Listen for changes in system theme
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', applyTheme);
  </script>
  <meta charset="UTF-8">
  <title>STROW Account Change</title>
  <style>
/* Unified input styling */
input[type="text"],
input[type="password"],
input[type="email"],
select {
  background-color: white;
  border: 3px solid transparent;
  border-radius: 1rem;
  padding: 0.6rem 1rem;
  font-size: 1rem;
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
  outline: none;
  text-align: center;
  font-family: sans-serif;

  background-image: linear-gradient(to bottom left, #00FFFF, #00FF7F), white;
  background-origin: border-box;
  background-clip: padding-box, border-box;

  box-shadow: 0 0 8px rgba(0, 255, 127, 0.4);
  transition: box-shadow 0.3s ease;
}

/* Focus glow */
input[type="text"]:focus,
input[type="password"]:focus,
input[type="email"]:focus,
select:focus,
textarea:focus {
  box-shadow: 0 0 8px rgba(0, 255, 255, 0.5);
}

/* Button styling replaces input[type="submit"] and input[type="button"] */
button {
  color: white;
  font-size: 1rem;
  font-weight: bold;
  padding: 0.75rem 1.5rem;
  border: none;
  border-radius: 1rem;
  cursor: pointer;
  background-image: linear-gradient(to bottom left, #00FFFF, #00FF7F);
  box-shadow: 0 4px 8px rgba(0, 255, 127, 0.3);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  font-family: sans-serif;
}

/* Hover and active effects for buttons */
button:hover {
  transform: scale(1.05);
  box-shadow: 0 6px 12px rgba(0, 255, 127, 0.4);
}

button:active {
  transform: scale(0.98);
  box-shadow: 0 2px 6px rgba(0, 255, 127, 0.2);
}.custom-checkbox{display:inline-flex;align-items:center;gap:.5rem;font-size:1rem;cursor:pointer;user-select:none}.custom-checkbox input[type=checkbox]{display:none}.custom-checkbox .checkmark{width:20px;height:20px;border-radius:6px;background-image:linear-gradient(to bottom left,#0ff,#00ff7f);box-shadow:0 2px 6px rgba(0,255,127,.3);position:relative;transition:box-shadow .2s ease}.custom-checkbox:hover .checkmark{box-shadow:0 4px 10px rgba(0,255,127,.4)}.custom-checkbox input[type=checkbox]:checked+.checkmark:after{content:"";position:absolute;left:6px;top:2px;width:6px;height:12px;border:solid #fff;border-width:0 2px 2px 0;transform:rotate(45deg)}.custom-checkbox input[type=checkbox]:checked+.checkmark{box-shadow:0 0 8px rgba(0,255,255,.5)}button#uploadButton{color:#fff;font-size:1rem;font-weight:700;padding:.75rem 1.5rem;border:none;border-radius:1rem;cursor:pointer;background-image:linear-gradient(to bottom left,#0ff,#00ff7f);transition:transform .2s ease,box-shadow .2s ease;box-shadow:0 4px 8px rgba(0,255,127,.3)}button#uploadButton:hover{transform:scale(1.05);box-shadow:0 6px 12px rgba(0,255,127,.4)}button#uploadButton:active{transform:scale(.98);box-shadow:0 2px 6px rgba(0,255,127,.2)}
</style>
</head>
<body><div class="grid-overlay"></div>
  <div class="content"><h1>STROW Account Change</h1><p>Log in or sign up?</p>
  <select id="modeSelect" name="mode">
    <option value="login">Log In</option>
    <option value="signup">Sign Up</option>
  </select><p>Username:</p><input type="text" id="username">
  <p>Password:</p><input type="password" id="password">
  <p id="confirmlabel">Confirm Password:</p><input type="password" id="confirm">
  <p>Optional Recovery Email:</p><input type="email" id="email">
  <br><br><label class="custom-checkbox">I agree to put a cookie on my device strictly to stay logged in: <input type="checkbox" id="cookiePermission" name="cookiePermission"> <span class="checkmark"></span></label><br><br><button class="button" onclick="submitLogin()" id="accountchange">Log In</button><br><br><button class="button" onclick="submitRecovery()" id="recoverybutton">Reset Password</button>
  
  
  <br><br><div class="status" id="status"></div>

  <script>
    function findColorScheme(){const e=!window.matchMedia("(prefers-color-scheme: dark)").matches;return document.getElementById("dynamic-theme").textContent=e?lightCSS:darkCSS,e}
    async function getFingerprints() {
      const traits = [
        navigator.userAgent,
        navigator.language,
        screen.width,
        screen.height,
        screen.colorDepth,
        new Date().getTimezoneOffset(),
        navigator.platform,
        navigator.hardwareConcurrency,
        navigator.deviceMemory || 'unknown',
      ];
      const rawData = traits.join('::');
      const encoder = new TextEncoder();
      const buffer = await crypto.subtle.digest('SHA-256', encoder.encode(rawData));
      const hex = Array.from(new Uint8Array(buffer)).map(b => b.toString(16).padStart(2, '0')).join('');
      const base64 = btoa(rawData);
      return { hex, base64 };
    }
(async () => {
  const { hex, base64 } = await getFingerprints();
  const query = new URLSearchParams({
    mode: "cssc",
    fingerprint: hex,
    colorscheme: findColorScheme()
  }).toString();

  const response = await fetch(`https://script.google.com/macros/s/AKfycby-tbywOAlG6XyqP0hOOL7LCRnlPIVbMXBIrSL-yFOKiwoRkta5jOTozoNWkMtnNExs/exec?${query}`);
  const result = await response.json();
  console.log("CSSC result:", result);
})();
    async function accountChangeFunction(data, redirectOnSuccess = true) {
      try {
        const query = new URLSearchParams(data).toString();
        const response = await fetch(`https://script.google.com/macros/s/AKfycby-tbywOAlG6XyqP0hOOL7LCRnlPIVbMXBIrSL-yFOKiwoRkta5jOTozoNWkMtnNExs/exec?${query}`);
        const result = await response.json();

        if (result.success) {
          if (redirectOnSuccess) {
            if (result.cookie !== "") { const cookieCreationDate = new Date(); // actual Date object
const expirationDate = new Date(cookieCreationDate.getTime() + (90 * 24 * 60 * 60 * 1000));
document.cookie = `verification=${result.cookie}; expires=${expirationDate.toUTCString()}; path=/; secure; samesite=strict`;
const response = await fetch(`https://script.google.com/macros/s/AKfycby-tbywOAlG6XyqP0hOOL7LCRnlPIVbMXBIrSL-yFOKiwoRkta5jOTozoNWkMtnNExs/exec?${new URLSearchParams({ mode: "cookie", creationTimestamp: cookieCreationDate.toISOString(), expirationTimestamp: expirationDate.toISOString(), colorscheme: findColorScheme(), cookie: result.cookie }).toString()}`); }
            window.location.href = "https://ktgeofficial.github.io/STROW/";
          } else {
            document.getElementById('status').textContent = "Recovery email sent if matched.";
          }
        } else {
          document.getElementById('status').textContent = result.message || "Operation failed.";
        }
      } catch (err) {
        document.getElementById('status').textContent = "Error communicating with server.";
      }
    }

    async function submitSignup() {
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;
      const confirm = document.getElementById('confirm').value;
      const email = document.getElementById('email').value.trim();
      const isCookie = document.getElementById('cookiePermission').checked;
      const { hex, base64 } = await getFingerprints();

      const payload = {
        mode: "signup",
        username,
        password,
        confirm,
        email,
        action: "accountChange",
        fingerprint: hex,
        pseudofingerprint: base64,
        colorscheme: findColorScheme(),
        isCookie
      };

      accountChangeFunction(payload);
    }

    async function submitLogin() {
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;
      const email = document.getElementById('email').value.trim();
      const isCookie = document.getElementById('cookiePermission').checked;
      const { hex, base64 } = await getFingerprints();

      const payload = {
        mode: "login",
        action: "Login",
        username,
        password,
        email,
        fingerprint: hex,
        pseudofingerprint: base64,
        colorscheme: findColorScheme(),
        isCookie
      };

      accountChangeFunction(payload);
    }

    async function submitRecovery() {
      const username = document.getElementById('username').value.trim();
      const email = document.getElementById('email').value.trim();
      const { hex, base64 } = await getFingerprints();

      const payload = {
        mode: "login",
        action: "Reset Password",
        username,
        password: "", // not needed
        email,
        fingerprint: hex,
        pseudofingerprint: base64,
        colorscheme: findColorScheme()
      };

      accountChangeFunction(payload, false);
    }
  </script><script>
  function updateModeUI() {
    const mode = document.getElementById('modeSelect').value;
    const confirmLabel = document.getElementById('confirmlabel');
    const confirmInput = document.getElementById('confirm');
    const recoveryButton = document.getElementById('recoverybutton');
    const accountChangeButton = document.getElementById('accountchange');

    if (mode === 'login') {
      // Hide confirm fields
      confirmLabel.style.display = 'none';
      confirmInput.style.display = 'none';

      // Show recovery button
      recoveryButton.style.display = 'inline-block';

      // Update button text and behavior
      accountChangeButton.textContent = 'Log In';
      accountChangeButton.setAttribute('onclick', 'submitLogin()');
    } else if (mode === 'signup') {
      // Show confirm fields
      confirmLabel.style.display = 'block';
      confirmInput.style.display = 'block';

      // Hide recovery button
      recoveryButton.style.display = 'none';

      // Update button text and behavior
      accountChangeButton.textContent = 'Sign Up';
      accountChangeButton.setAttribute('onclick', 'submitSignup()');
    }
  }

  // Attach listener on page load
  document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('modeSelect').addEventListener('change', updateModeUI);
    updateModeUI(); // Initialize on load
  });
</script>


</div>



</body></html>





















